from lib.actions import BaseAction
import json
import os


class SubmitMalwareAction(BaseAction):
    def run(self, **kwargs):
        file_basename = on.path.basename(file_name)
        payload = json.dumps(kwargs)
        files = [
            ('file', (file_basename, open(file_name, 'rb'), file_type)),
            ('file', ('analysis.json', payload, 'application/json'))
        ]
        url = '/'.join(self._url, submission)

        r = requests.post(url=url, headers=self._headers, files=files)
        r.raise_for_status()
        return r.to_json()
